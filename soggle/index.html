<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimal-ui">
    <title>Soggle!</title>
    <link rel="icon" type="image/x-icon" href="icon.png">

    <meta itemprop="name" content="soggle!">
    <meta itemprop="description" content="guess images of shark by their small fragment">

    <meta name="twitter:title" content="ssoggycat">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="summary">
    <meta name="twitter:site" content="@ssoggycat">
    <meta name="twitter:creator" content="@cvsilly_">

    <style>
        @font-face {
            font-family: "karnak condensed"; font-weight: 200 700;
            src: url("assets/fonts/karnakcondensed.woff") format("woff");
        }
        @font-face {
            font-family: "karnak"; font-weight: 200 700;
            src: url("assets/fonts/karnak.woff") format("woff");
        }
        @font-face {
            font-family: "clear sans"; font-weight: 200 700;
            src: url("assets/fonts/clearsans.woff") format("woff");
        }

        /*//////////////////////////////////////////////////////////////////////*/

        body {
            display: flex; margin: 0;
            justify-content: center; align-items: center;
            background-color: #121213; scrollbar-width: thin;
            scrollbar-color: #212121 #121213;
        }
        .top {
            display: flex; position: fixed;
            justify-content: center; align-items: center;
            width: 100vw; height: 60px; top: 0; gap: 3px;
            background-color: #121213; border-bottom: 1px solid #212121;
        }
        .bottom {
            display: flex; position: fixed;
            bottom: 2em; left: 50%;
            transform: translateX(-50%);
            justify-content: center; align-items: stretch;
            width: min(20em, calc(100vw - 2em)); height: 3em;
        }
        .leftbutton, .submit, .hardmodebutton, .input {
            height: 100%; box-sizing: border-box; padding: 0 10px;
            display: flex; align-items: center; justify-content: center;
        }

        .input-group {
            display: flex; height: 100%;
            align-items: stretch;
        }
        .button-group {
            margin-right: 15px;
        }

        .overlay {
            display: flex; position: fixed;
            justify-content: center; align-items: center;
            top: 0; left: 0; z-index: 9999;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.25s;
        }
        .popup {
            display: flex; flex-direction: column;
            justify-content: flex-start;
            width: 400px; max-width: 70vw;
            max-height: 80vh; padding: 30px;
            background-color: #121213;
            overflow-y: auto; box-sizing: border-box;
        }
        .sogface {height: 2em}

        img, canvas, .popup {border-radius: 10px;}

        /*//////////////////////////////////////////////////////////////////////*/

        a, span, br {
            color: white; 
            font-family: "clear sans", sans-serif;
            user-select: none;
        }
        :any-link {color: #6ba1dd;}

        .title {font-family: "karnak condensed", sans-serif; font-size: 2em;}
        .subtitle {font-family: "karnak", sans-serif; font-size: 1.5em;}
        .small {font-size: 0.75em;}
        .tiny {font-size: 0.5em;}
        .dark {color: #999;}

        /*//////////////////////////////////////////////////////////////////////*/

        .close {display: flex; top: 0; justify-content: right;}
        button {
            min-height: 3em; min-width: 3em !important; 
            background: none; appearance: none; border: none;
            padding: 0; outline: none; box-shadow: none;
            cursor: pointer; user-select: none;
            box-sizing: border-box;
        }
        .buttons {
            display: flex; position: absolute;
            align-items: center; justify-content: right;
            right: 1em; height: 100%; top: 0; gap: 5px;
        }
        .buttons img {
            width: 30px; height: 30px;
            object-fit: contain; object-position: left center;
        }

        .leftbutton {
            box-sizing: border-box; padding: 10px;
            display: flex; align-items: center; justify-content: center;
            font-family: "karnak", sans-serif; background: #18181a;
            color: white; border: 1.5px solid #212121;
            font-size: 1em;
        }

        .shuffle {
            height: auto !important;
            font-size: 0.8em !important;
        }

        /* fml */
        .hinthard {
            min-height: 3em;
            font-size: 0.8em !important;
        }
        .hinthard:disabled {
            background: #0f0f0f; color: #555;
            cursor: not-allowed;
        }
        .hardmode {
            color: #dd4444;
            font-size: 0.9em !important;
        }
        .hardmodebutton {
            min-height: 3em; min-width: 4em !important;
            box-sizing: border-box; margin-left: 15px;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .input {
            font-family: "karnak", sans-serif; font-size: 1em;
            background: #18181a !important; color: white !important;
            padding: 10px; border: 1.5px solid #212121;
            width: 300px; outline: none;
            transition: border-color 0.2s;
            height: 3em; box-sizing: border-box;
            vertical-align: middle;
        }
        .input::placeholder {color: #666; transition: color 0.2s;}
        .input.error {border-color: #dd4444;}
        .input.error::placeholder {color: #dd4444;}

        .submit {
            display: flex; font-family: "karnak", sans-serif; font-size: 1em;
            background: #18181a; color: white;
            justify-content: center; align-items: center;
            padding: 8px; border: 1.5px solid #212121;
            width: 3em; height: 3em; line-height: 1em;
            box-sizing: border-box; outline: none;
        }

        .guesscounter {
            font-family: "karnak", sans-serif; font-size: 0.6em;
            color: #999; text-align: center; height: 15px;
            width: 100%; display: block; margin: 0 auto;
        }
        .guesscounter:not(:empty) {margin-top: 5px}

        /*//////////////////////////////////////////////////////////////////////*/

        .example {
            font-family: "karnak", sans-serif;
            font-size: 0.75em; line-height: 0;
            background: #18181a; color: white;
            border: 1.5px solid #212121;
            padding: 0 !important; margin: 0 !important;
            min-height: 1em !important; max-height: 1em !important;
            vertical-align: middle;
        }
        .dude {
            width: 100vw; height: 100vh;
            z-index: 99999; display: none; opacity: 0;
        }

        .imagebox {
            display: flex; position: absolute;
            justify-content: center; align-items: center;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            max-width: 70%; max-height: 70%; width: 1000px; height: 1000px;
            pointer-events: none; user-select: none; z-index: -1;
        }
        .imagebox canvas {max-width: 100%; max-height: 100%}

        .answer {
            position: fixed; font-family: "karnak", sans-serif; font-size: 1em;
            color: #6ba1dd; background: #18181a;
            padding: 8px 15px; border: 1.5px solid #212121;
            border-radius: 10px; z-index: 1000; opacity: 0;
            transition: opacity 0.3s; pointer-events: none;
        }
        .answer.show {opacity: 1;}

        .button-group {
            display: flex; flex-direction: row; 
            gap: 0
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .suggestions {
            position: absolute; background: #18181a; 
            border: 1.5px solid #212121; border-top: none;
            max-height: 200px; overflow-y: auto;
            width: 100%; z-index: 10000; left: 0; top: 100%;
            box-sizing: border-box; border-radius: 0 0 10px 10px;
            transition: top 0.1s, bottom 0.1s;
        }
        .suggestions.above {
            border-radius: 10px 10px 0 0; border-bottom: none;
            border-top: 1.5px solid #212121;
            top: auto; bottom: 100%;
        }
        .suggestion-item {
            padding: 10px; cursor: pointer;
            font-family: "karnak", sans-serif;
            color: white; background: #18181a;
            border-bottom: 1px solid #212121;
            transition: background 0.1s, color 0.1s;
        }

        .suggestion-item:last-child {border-bottom: none}
        .suggestion-item.active, .suggestion-item:hover {background: #23232a}
        .suggestion-item.incorrect {
            color: #fff; background: #3a181a;
            border-left: 4px solid #dd4444;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        @media (min-width: 601px) {
            .hint {
                max-width: 4em !important;
            }
            .hinthard {
                max-width: 4em !important;
            }
        }

        /* mobile view */
        @media (max-width: 600px) {
            .leftbutton {
                font-size: 1em !important;
            }
            .bottom {
                flex-direction: column; align-items: center;
                justify-content: flex-start; height: auto; gap: 0;
                bottom: 10px; width: 100vw; left: 0; bottom: 2em;
                transform: none; padding: 0
            }

            .button-group {width: 90vw; max-width: 400px; margin-bottom: 8px}
            .button-group .leftbutton {flex: 1 1 0; margin: 0;}
            .inputbox {width: 90vw; max-width: 400px; margin: 0 auto;}
            .input-group {width: 100%; display: flex;}
            .input {width: 100%; min-width: 0; box-sizing: border-box;}
            .submit {width: 3em; min-width: 3em; max-width: 3em;}

            .hardmodebutton {
                width: 90vw; max-width: 400px; margin: 8px 0 0 0;
                border-radius: 0 0 10px 10px; border-top: none;
                display: flex; justify-content: center;
            }
            .guesscounter {
                width: 100vw; max-width: 400px; text-align: center;
                margin: 16px auto 0 auto; align-self: center;
                position: relative; left: 0;
            }

            .hardmodebutton, .button-group {
                margin-left: 0; margin-right: 0;
            }
        }
        .guesscounter {
            position: fixed; left: 50%;
            bottom: 0.5em; transform: translateX(-50%);
            font-family: "karnak", sans-serif; font-size: 0.6em;
            color: #999; text-align: center;
            height: 15px; width: 100vw; max-width: 400px;
            margin: 0; background: none;
            z-index: 100; clear: none; float: none;
        }

    </style>

</head>
<body>

    <div class="top">
        <a class="title">Soggle</a>
        <img class="sogface" src="assets/images/sogface.webp" draggable="false">

        <div class="buttons">
            <button class="volume">
                <img src="assets/svgs/unmuted.svg" height="30" draggable="false">
            </button>
            <button class="info">
                <img src="assets/svgs/info.svg" height="30" draggable="false">
            </button>
        </div>
    </div>

    <img class="dude" src="assets/images/dude.webp" draggable="false">
    <audio class="meow" style="display:none" src="assets/audio/meow.mp3" preload="auto"></audio>
    <audio class="buzzer" style="display:none" src="assets/audio/buzzer.mp3" preload="auto"></audio>

    <div class="overlay infooverlay" style="display: none;">
        <div class="infopopup popup">

            <div class="close">
                <button class="infocloseb">
                    <img src="assets/svgs/close.svg" height="30" draggable="false">
                </button>
            </div>

            <a class="title">Soggle</a>
            <a class="subtitle small">wordle but sog. do you get it. do you?</a>
            <br>
            <span>get 380+ titles of images of shark right!</span>
            <br>
            <span>this game is based on the <a href="https://drive3.soggy.cat">soggy drive</a>'s file naming system, which is most commonly used across reposts.</span>
            <span>you should familiarize yourself with it before even considering playing this..</span>
            <span class="tiny dark">(it"s a pretty bad concept for a game, but hey, there had to be a soggy cat wordle at some point)</span>
            <br>
            <a class="subtitle">how to play</a>
            <span>if you remember the image's name from the drive, input its filename. <a class="dark">(ex. "pillow<s class="darker">.jpg</s>")</a></span>
            <br>
            <span>if not, you can press the <button class="example">hint</button> button to reveal the length!</span>
            <br>
            <span>if you're stuck, you can <button class="example" style="vertical-align: middle;">shuffle</button> for a new soggle.</span>
            <br>
            <a class="subtitle">hard mode</a>
            <span><button class="example" style="vertical-align: middle; color: #dd4444">hard mode</button> crops the image into a small segment!</span>
            <br>
            <span>it starts off at ⅛th, but you can use the <button class="example" style="vertical-align: middle;">hint</button> button to reveal up to half of it.</span>

        </div>
    </div>

    <div class="overlay winoverlay" style="display: none;">
        <div class="winpopup">
            <img src="assets/images/riches.webp" width="100%" draggable="false">
        </div>
    </div>

    <div class="imagebox">
        <canvas class="sog" width="1000" height="1000"></canvas>
    </div>

    <div class="answer answertext"></div>

    <div class="bottom">
        <div class="button-group">
            <button class="leftbutton shuffle">shuffle</button>
            <button class="leftbutton hint">hint</button>
            <button class="leftbutton hinthard" style="display: none;">hint (+¼)</button>
        </div>
        <div class="inputbox">
            <div class="input-group">
                <input class="input" type="text" placeholder="name it!">
                <div class="suggestions" style="display:none;"></div>
                <button class="submit">↵</button>
            </div>
        </div>
        <button class="leftbutton hardmode hardmodebutton">hard mode</button>
    </div>

    <div class="guesscounter"></div>

    <script>
        const ctx = document.querySelector(".sog").getContext("2d");
        const hinthardlabels = {8: "⅛", 4: "¼", 2: "½"};
        const positions = ["top", "bottom", "left", "right"];

        function updatehinthard() {
            const hinthardbutton = document.querySelector(".hinthard");
            const nextfraction = game.fraction / 2;
            if (nextfraction < 2) {
                hinthardbutton.disabled = true;
                hinthardbutton.textContent = "max";
            } else {
                hinthardbutton.textContent = `hint (+${hinthardlabels[nextfraction]})`;
                hinthardbutton.disabled = false;
            }
        }

        function updateguesscounter() {
            const counter = document.querySelector(".guesscounter");
            if (game.guesscount > 0) {
                const label = game.guesscount === 1 ? "guess" : "guesses";
                counter.textContent = `${game.guesscount} ${label}`;
            } else {
                counter.textContent = "";
            }
        }

        function newfragment() {
            if (!game.image) return;
            const canvas = document.querySelector(".sog");
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const img = game.image;
            const scale = Math.min(1000 / img.width, 1000 / img.height);
            const scaledwidth = img.width * scale;
            const scaledheight = img.height * scale;
            const offsetx = (1000 - scaledwidth) / 2;
            const offsety = (1000 - scaledheight) / 2;
            let sx = 0, sy = 0, sw = img.width, sh = img.height;
            let dx = offsetx, dy = offsety, dw = scaledwidth, dh = scaledheight;
            const f = game.fraction;
            if (game.position === "top" || game.position === "bottom") {
                sh = img.height / f;
                dh = scaledheight / f;
                if (game.position === "bottom") {
                    sy = img.height * (f - 1) / f;
                    dy = offsety + scaledheight * (f - 1) / f;
                }
            } else if (game.position === "left" || game.position === "right") {
                sw = img.width / f;
                dw = scaledwidth / f;
                if (game.position === "right") {
                    sx = img.width * (f - 1) / f;
                    dx = offsetx + scaledwidth * (f - 1) / f;
                }
            }
            ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh);
        }

        const baseurl = ["assets/images/soggy/"]
        const images = [
            "AAAAAAH (hq).webp", "AAAHHH.webp", "a new guest.webp", "alien 2.webp", "alien 3.webp", "alien 4.webp", "alien.webp", "angry cuddled 2.webp", "angry cuddled.webp", "angry sob.webp", "angry.webp", "are you fr.webp", "autumn 2.webp", "autumn.webp", "aww look at him.webp",
            "baby.webp", "baffled.webp", "baggage.webp", "ball.webp", "balls.webp", "beauty 2.webp", "beauty.webp", "big ass nose.webp", "big nose.webp", "bit happy 2.webp", "bit happy.webp", "bite 2.webp", "bite.webp", "blanket 2.webp", "blanket.webp", "blankets.webp", "bleh.webp", "blink.webp", "blurry.webp", "burger 2.webp", "burger.webp",
            "camera.webp", "casual.webp", "casually sitting.webp", "chad.webp", "cheese 2.webp", "cheese.webp", "chiffy.webp", "childrens zone.webp", "chill.webp", "close peek.webp", "close up.webp", "close-up.webp", "comfy blanket.webp", "confused.webp", "conservative 2.webp", "conservative.webp", "contained.webp", "cool collar.webp", "couch.webp", "creature.webp", "creepy.webp", "creepypasta.webp", "critical hit.webp", "crying.webp", "cuddled 2.webp", "cuddled.webp",
            "DISGUSTED.webp", "damn thats crazy.webp", "dance.webp", "darkness.webp", "deep sea creature 2.webp", "deep sea creature.webp", "dem paws 2.webp", "dem paws.webp", "demon under your bed.webp", "demon.webp", "derp.webp", "disappointed.webp", "disapproval.webp", "drowning in plushies.webp", "dry standing.webp", "dumb 2.webp", "dumb sit.webp", "dumb.webp",
            "EVIL CREATURE.webp", "EVIL.webp", "ear grab.webp", "earless.webp", "eepy.webp", "egg broke.webp", "egg.webp", "empty stare.webp", "enraged.webp", "epic selfie 2.webp", "epic selfie.webp", "erm.webp", "err.webp", "even uglier.webp", "evil goblin.webp", "ew.webp", "eyebrow raise.webp",
            "fack u.webp", "far away.webp", "fart 2.webp", "fart.webp", "fatass 2.webp", "fatass.webp", "fear.webp", "felinus.webp", "final footage.webp", "finger.webp", "flat.webp", "fluffy guy.webp", "fluffy.webp", "four doritos long 2.webp", "four doritos long.webp", "four step stool.webp", "fresh.webp", "from the shadows.webp", "fuck yuo.webp", "fucked up.webp",
            "gamer.webp", "gang.webp", "garage 2.webp", "garage.webp", "gay.webp", "giant.webp", "giraffe.webp", "gn.webp", "golly jeepers.webp", "goog .webp", "goog.webp", "grab the cat.webp", "grab!!.webp", "green eye.webp", "green eyed 2.webp", "green eyed.webp", "grin.webp", "groceries.webp", "grr.webp", "guuuuh.webp", "guweh.webp", "gwah 2.webp", "gwah 3.webp", "gwah.webp",
            "half view.webp", "hamburger.webp", "hand lick.webp", "happy face.webp", "he has one braincell.webp", "hello there.webp", "hello.webp", "hey.webp", "hide.webp", "hiding.webp", "hii.webp", "holding the bathtub.webp", "horrific 2.webp", "horrific 3.webp", "horrific.webp", "horror.webp", "huh.webp", "hunter.webp",
            "IT'S SNOWING IT'S SNOWING IT'S SNOWING.webp", "i got cash on me.webp", "i will find you.webp", "idiot.webp", "idk.webp", "impatient son.webp", "in bed 2.webp", "in bed.webp", "insane.webp", "it says gullible on the ceiling.webp",
            "jawline.webp", "just chillin brah.webp", "just minutes before the sog.webp",
            "kiss.webp",
            "lay 2.webp", "lay me down.webp", "lay.webp", "laying.webp", "lets see if this is true or rubbish.webp", "lick.webp", "literally DEAD.webp", "long.webp", "look away.webp", "look.webp", "looking outside.webp", "looking up.webp", "lovely blanket.webp",
            "m.webp", "mad 2.webp", "mad.webp", "meow.webp", "mewing.webp", "miau 2.webp", "miau.webp", "mid fart.webp", "mimimi.webp", "moments before disaster.webp", "mrow.webp", "murder 2.webp", "murder.webp",
            "nap.webp", "new york apartment.webp", "no ears.webp", "nom.webp", "non-deep sea creature.webp", "nose to the right.webp", "nose to the top.webp", "not aaah.webp", "not so evil anymore.webp",
            "okay sure.webp", "one ruffle cheddar long.webp", "outside.webp",
            "package.webp", "panic.webp", "pants.webp", "pat from the back.webp", "paw 2.webp", "paw licking.webp", "paw.webp", "paws.webp", "peering closer to the enemy.webp", "penis.webp", "pent up.webp", "pet on the back.webp", "pet pet pet.webp", "pet.webp", "pillow.webp", "pinned down.webp", "piss.webp", "plastic cup.webp", "playground 2.webp", "playground.webp", "plead.webp", "pluh.webp", "plushie 2.webp", "plushie.webp", "pog.webp", "polite.webp", "popsicle.webp", "prayers.webp", "preparation.webp", "prepared.webp", "preparing his attack.webp", "proud stand.webp", "psychopath.webp", "purr.webp", "pushing away.webp",
            "quicksand 2.webp", "quicksand.webp",
            "RAAH.webp", "raaah.webp", "rapidly approaching.webp", "restrained evil.webp", "rich.webp", "rubber ducky.webp",
            "SCREAM FOR HELP.webp", "sad face.webp", "sad.webp", "scared.webp", "scream.webp", "selfie.webp", "shock.webp", "shocking.webp", "shoes.webp", "shut up.webp", "side of the road.webp", "side sleep.webp", "sigma.webp", "sit.webp", "skinwalker pretending to be a cat.webp", "sleeping.webp", "sleepy.webp", "slide to the left.webp", "smirk.webp", "smoke weed every day.webp", "snake.webp", "sneak.webp", "sniff 2.webp", "sniff 3.webp", "sniff.webp", "snooping around.webp", "snore.webp", "snowed up 2.webp", "snowed up.webp", "so damn long.webp", "sob.webp", "sobbing.webp", "soft covers.webp", "sog look.webp", "sog stare.webp", "soggy.webp", "spooky.webp", "stand.webp", "standing out there.webp", "standing.webp", "stare.webp", "stares at you.webp", "staring.webp", "stealth.webp", "sticking out tongue.webp", "striking a pose.webp", "sun rays.webp", "suspension.webp",
            "THE BEAST HAS AWOKEN.webp", "teehee.webp", "terrifying.webp", "the crap.webp", "the creature.webp", "the thing.webp", "thing.webp", "thug gangster ass shit 2.webp", "thug gangster ass shit.webp", "tilt.webp", "tired.webp", "tongue.webp", "trampoline fear 2.webp", "trampoline fear.webp", "trampoline trapped.webp", "trampoline.webp", "trapped.webp", "trauma.webp", "traumatized.webp", "true fear.webp", "trying to sleep.webp", "tub.webp",
            "ugly.webp", "uh um.webp", "um hello.webp", "unsightly beast.webp", "unsure.webp",
            "very chill.webp", "very ugly.webp",
            "WHAT.webp", "WHUHH.webp", "waddle.webp", "walking away.webp", "weird sit.webp", "weirdo.webp", "went outside.webp", "wha.webp", "whagt.webp", "whats that.webp", "who are you.webp", "whoa.webp", "whuh...webp", "why does he look like that.webp", "why the big nose.webp", "why the wide face.webp", "wide lay.webp", "wink.webp", "wise thinker.webp", "wise.webp", "woah.webp", "womp womp.webp", "wonderful bench.webp", "wtf did you just say.webp", "wtf.webp",
            "YOU.webp", "yay.webp", "yeah okay.webp", "yellow eyed.webp", "you all sicken me.webp", "yucky.webp", "yummers.webp", "yummy.webp",
            "zzz.webp"
        ];

        // game state
        let game = {
            image: null,
            imagename: "",
            imagenamefile: "",
            fraction: 1,
            position: "",
            haswon: false,
            guesscount: 0
        };

        // kind of? prevent animation spam
        let isanimating = false;
        let isansweranimating = false;

        let incorrectanswers = new Set();

        function random(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        async function loadimage(imagename) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                const imagenamefix = imagename.replace(/_/g, "%20");
                let urlindex = 0;

                const loadurl = () => {
                    if (urlindex >= baseurl.length) {
                        reject(new Error("all urls failed?!"));
                        return;
                    }
                    img.src = baseurl[urlindex] + imagenamefix; 
                    urlindex++;
                    
                    const timeout = setTimeout(() => {
                        img.onload = img.onerror = null;
                        loadurl();
                    }, 3000);
                    img.onload = () => {clearTimeout(timeout); resolve(img)};
                    img.onerror = () => {clearTimeout(timeout); loadurl()};
                }; 
                loadurl();
            });
        }

        //////////////////////////////////////////////////////////////////////////

        function savegamestate() {
            const gamestate = {
                imagenamefile: game.imagenamefile,
                hardmode: document.querySelector(".hardmodebutton").textContent === "normal mode",
                fraction: game.fraction,
                position: game.position,
                incorrectanswers: Array.from(incorrectanswers),
                guesscount: game.guesscount
            };
            localStorage.setItem("gamestate", JSON.stringify(gamestate));
        }
        async function loadgamestate() {
            const saved = localStorage.getItem("gamestate");
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    if (state.imagenamefile && images.includes(state.imagenamefile)) {
                        const img = await loadimage(state.imagenamefile);
                        game.image = img;
                        game.imagenamefile = state.imagenamefile;
                        game.imagename = state.imagenamefile.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "").replace(/_/g, " ");
                        game.fraction = state.fraction || 1;
                        game.position = state.position || random(positions);
                        game.haswon = false;
                        game.guesscount = state.guesscount || 0;
                        incorrectanswers = new Set(state.incorrectanswers || []);
                        const hardbutton = document.querySelector(".hardmodebutton");
                        if (state.hardmode) {
                            // Hard mode ON
                            hardbutton.textContent = "normal mode";
                            hardbutton.style.color = "white";
                            document.querySelector(".hinthard").style.display = "flex";
                            document.querySelector(".hint").style.display = "none";
                        } else {
                            // Hard mode OFF
                            hardbutton.textContent = "hard mode";
                            hardbutton.style.color = "#dd4444";
                            document.querySelector(".hint").style.display = "flex";
                            document.querySelector(".hinthard").style.display = "none";
                        }
                        updatehinthard();
                        updateguesscounter();
                        newfragment();
                        return true;
                    }
                } catch (e) {}
            }
            return false;
        }

        //////////////////////////////////////////////////////////////////////////

        async function newgame(fraction = null, keepmode = false) {
            let hardmode = document.querySelector(".hardmodebutton").textContent === "normal mode";
            if (fraction === null) {
                fraction = hardmode ? 16 : 1;
            }
            game.haswon = false;
            game.guesscount = 0;
            incorrectanswers.clear();
            for (let attempts = 0; attempts < images.length; attempts++) {
                const imagename = random(images);
                try {
                    const img = await loadimage(imagename);
                    game.image = img;
                    game.imagenamefile = imagename;
                    game.imagename = imagename.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "").replace(/_/g, " ");
                    game.fraction = fraction;
                    game.position = random(positions);
                    const input = document.querySelector(".input");
                    input.value = "";
                    input.placeholder = "name it!";
                    input.classList.remove("error");
                    updatehinthard();
                    updateguesscounter();
                    newfragment();
                    savegamestate();
                    return;
                } catch (err) {
                    console.error(`failed to load this goober - ${imagename}:`, err);
                }
            }
            document.querySelector(".input").placeholder = "no images available?!";
        }

        function showanswer(crossed = false) {
            const answertext = document.querySelector(".answertext");
            const input = document.querySelector(".input");
            const inputrect = input.getBoundingClientRect();

            let displayname;
            if (crossed) {
                displayname = game.imagename.replace(/[^\s]/g, "-");
                const length = game.imagename.replace(/\s/g, "").length;
                answertext.textContent = `${displayname} (${length} symbols)`;
            } else {
                answertext.textContent = `the image was: ${game.imagename}`;
            }

            answertext.style.left = `${inputrect.left + inputrect.width / 2}px`;
            answertext.style.top = `${inputrect.top - 50}px`;
            answertext.style.transform = "translateX(-50%)";

            // force reset
            answertext.classList.remove("show");
            void answertext.offsetWidth;
            answertext.classList.add("show");

            clearTimeout(answertext._timeout);
            answertext._timeout = setTimeout(() => {
                answertext.classList.remove("show");
            }, 2000);
        }

        document.querySelector(".hint").addEventListener("click", () => {
            showanswer(true);
        });

        /*                                                       /
        
        
                  WIN FUNCTION BELOW!!!!!!!! YOU IDIOT
               (just to cv, not anyone else reading this)
        
        
        /                                                       */
        function checkanswer() {
            const input = document.querySelector(".input");
            const answer = input.value.trim().toLowerCase();
            const correct = game.imagename.toLowerCase();
            
            if (answer === correct) {
                game.fraction = 1; 
                input.value = "";
                game.haswon = true;
                newfragment(); updatehinthard();
                document.querySelector(".meow").play()
                savegamestate();
                const winoverlay = document.querySelector(".winoverlay");
                winoverlay.style.opacity = "1";
                winoverlay.style.pointerEvents = "auto";
                setTimeout(() => {
                    winoverlay.style.transition = "opacity 4s";
                    winoverlay.style.opacity = "0";
                    winoverlay.style.pointerEvents = "none";
                    setTimeout(() => {
                        winoverlay.style.transition = "";
                        winoverlay.style.display = "none";
                    }, 4000);
                }, 100);
                winoverlay.style.display = "flex";

            } else {
                if (isanimating) return;
                isanimating = true;
                
                if (answer) {
                    incorrectanswers.add(answer);
                    game.guesscount++;
                    savegamestate();
                    updateguesscounter();
                }
                input.classList.add("error");
                input.placeholder = "[𝐋𝐎𝐔𝐃 𝐈𝐍𝐂𝐎𝐑𝐑𝐄𝐂𝐓 𝐁𝐔𝐙𝐙𝐄𝐑]";
                input.value = "";
                document.querySelector(".buzzer").pause(); 
                document.querySelector(".buzzer").currentTime = 0; 
                document.querySelector(".buzzer").play();
                setTimeout(() => {
                    input.classList.remove("error");
                    input.placeholder = "name it!";
                    isanimating = false;
                }, 500);
            }
        }

        //////////////////////////////////////////////////////////////////////////

        document.querySelector(".sogface").addEventListener("click", () => {
            document.querySelector(".meow").play();
        });

        document.querySelector(".shuffle").addEventListener("click", async () => {
            if (!game.haswon) {
                showanswer();
                setTimeout(async () => {
                    await newgame();
                }, 1000);
            } else {
                await newgame();
            }
        });

        document.querySelector(".hinthard").addEventListener("click", () => {
            if (game.image && game.fraction > 2) {
                game.fraction = game.fraction / 2;
                newfragment(); 
                updatehinthard();
                savegamestate();
            }
        });

        document.querySelector(".submit").addEventListener("click", checkanswer);
        document.querySelector(".input").addEventListener("keypress", (e) => {
            if (e.key === "Enter" || e.keyCode === 13) checkanswer();
        });

        const hardmodebutton = document.querySelector(".hardmodebutton");
        let hardmode = false;
        hardmodebutton.addEventListener("click", async () => {
            hardmode = !hardmode;
            if (hardmode) {
                hardmodebutton.textContent = "normal mode";
                hardmodebutton.style.color = "white";
                document.querySelector(".hinthard").style.display = "flex";
                document.querySelector(".hint").style.display = "none";
                await newgame(16);
            } else {
                hardmodebutton.textContent = "hard mode";
                hardmodebutton.style.color = "#dd4444";
                document.querySelector(".hint").style.display = "flex";
                document.querySelector(".hinthard").style.display = "none";
                await newgame(1);
            }
            savegamestate();
        });
        
        // prevent file extensions in input, just in case the player forgot
        document.querySelector(".input").addEventListener("input", function() {
            this.value = this.value.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "");
        });

        //////////////////////// custom input list ///////////////////////////////

        const inputelement = document.querySelector(".input");
        const suggestions = document.querySelector(".suggestions");
        let cleansuggestions = [];
        let currentsuggestion = -1;

        function cleanimagename(imagename) {
            return imagename.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "").replace(/_/g, " ");
        }

        function showsuggestions(value) {
            const val = value.trim().toLowerCase();
            if (!val) {
                suggestions.style.display = "none";
                suggestions.innerHTML = "";
                return;
            }
            cleansuggestions = images
                .map(cleanimagename)
                .filter(name => name.toLowerCase().includes(val))
                // .slice(0, 10);
            if (cleansuggestions.length === 0) {
                suggestions.style.display = "none";
                suggestions.innerHTML = "";
                return;
            }
            suggestions.innerHTML = cleansuggestions.map((s, i) => {
                const isIncorrect = incorrectanswers.has(s.toLowerCase());
                return `<div class="suggestion-item${i === currentsuggestion ? " active" : ""}${isIncorrect ? " incorrect" : ""}">${s}</div>`;
            }).join("");

            repositionsuggestions();
            suggestions.style.display = "block";
        }

        function repositionsuggestions() {
            suggestions.classList.remove("above");
            suggestions.style.top = "";
            suggestions.style.bottom = "";
            const inputrect = inputelement.getBoundingClientRect();
            const menuheight = Math.min(200, 40 * cleansuggestions.length);
            const spacebelow = window.innerHeight - inputrect.bottom;
            const spaceabove = inputrect.top;
            if (spacebelow < menuheight && spaceabove > spacebelow) {
                suggestions.classList.add("above");
            } else {
                suggestions.classList.remove("above");
            }
        }

        inputelement.addEventListener("input", function(e) {
            this.value = this.value.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "");
            currentsuggestion = -1;
            showsuggestions(this.value);
        });

        inputelement.addEventListener("keydown", function(e) {
            if (suggestions.style.display === "block") {
                if (e.key === "ArrowDown") {
                    e.preventDefault();
                    currentsuggestion = Math.min(currentsuggestion + 1, cleansuggestions.length - 1);
                    updatecurrentsuggestion();
                } else if (e.key === "ArrowUp") {
                    e.preventDefault();
                    currentsuggestion = Math.max(currentsuggestion - 1, 0);
                    updatecurrentsuggestion();
                } else if (e.key === "Enter") {
                    if (currentsuggestion >= 0 && cleansuggestions[currentsuggestion]) {
                        e.preventDefault();
                        selectsuggestion(cleansuggestions[currentsuggestion]);
                    }
                } else if (e.key === "Escape") {
                    suggestions.style.display = "none";
                }
            }
        });

        function updatecurrentsuggestion() {
            const items = suggestions.querySelectorAll(".suggestion-item");
            items.forEach((item, idx) => {
                item.classList.toggle("active", idx === currentsuggestion);
            });
        }
        function selectsuggestion(s) {
            inputelement.value = s;
            suggestions.style.display = "none";
            inputelement.focus();
        }
        suggestions.addEventListener("mousedown", function(e) {
            if (e.target.classList.contains("suggestion-item")) {
                e.preventDefault(); // Prevent input from losing focus
                selectsuggestion(e.target.textContent);
            }
        });
        document.addEventListener("click", function(e) {
            if (!suggestions.contains(e.target) && e.target !== inputelement) {
                suggestions.style.display = "none";
            }
        });
        window.addEventListener("resize", () => {
            if (suggestions.style.display === "block") {
                repositionsuggestions();
            }
        });

        //////////////////////////////// info tab ////////////////////////////////

        document.querySelectorAll(".example").forEach(el => {
            el.addEventListener("click", () => {
            const disappointment = document.querySelector(".dude");
            disappointment.style.display = "block";
            setTimeout(() => {
                disappointment.style.transition = "opacity 10s";
                disappointment.style.opacity = "1";
            }, 700);
            setTimeout(() => {
                disappointment.style.display = "none";
                disappointment.style.opacity = "0";
                disappointment.style.transition = "";
                el.remove();
            }, 8000);
            });
        });

        document.addEventListener("DOMContentLoaded", async () => {
            const visited = window.visited;
            if (!localStorage.getItem("visited")) {
                localStorage.setItem("visited", "true");
                const infooverlay = document.querySelector(".infooverlay");
                const infopopup = document.querySelector(".infopopup");
                infooverlay.style.display = "flex";
                infopopup.style.transition = "transform 0.25s";
                infopopup.style.transform = "translateY(-30px)";
                infooverlay.style.opacity = "1";
                infooverlay.style.pointerEvents = "auto";
                requestAnimationFrame(() => {infopopup.style.transform = ""});
            }
            let sitemuted = false;
            const volumebutton = document.querySelector(".volume");
            const volumeicon = volumebutton.querySelector("img");
            volumebutton.addEventListener("click", () => {
                sitemuted = !sitemuted;
                document.querySelectorAll("audio").forEach(audio => {
                    audio.muted = sitemuted;
                });
                volumeicon.src = sitemuted
                    ? "assets/svgs/muted.svg"
                    : "assets/svgs/unmuted.svg";
            });
            if (!(await loadgamestate())) {
                await newgame();
            }
        });

        document.querySelector(".info").addEventListener("click", () => {
            const infooverlay = document.querySelector(".infooverlay");
            const infopopup = document.querySelector(".infopopup");
            infooverlay.style.display = "flex";
            infopopup.style.transition = "transform 0.25s";
            infopopup.style.transform = "translateY(-30px)";
            infooverlay.style.opacity = "1";
            infooverlay.style.pointerEvents = "auto";
            requestAnimationFrame(() => {infopopup.style.transform = ""});
        });

        document.querySelector(".infocloseb").addEventListener("click", () => {
            const infooverlay = document.querySelector(".infooverlay");
            const infopopup = document.querySelector(".infopopup");
            infopopup.style.transition = "transform 0.25s";
            infopopup.style.transform = "translateY(30px)";
            infooverlay.style.opacity = "0";
            infooverlay.style.pointerEvents = "none";
            setTimeout(() => {
                infooverlay.style.display = "none";
                infopopup.style.transition = "";
                infopopup.style.transform = "";
            }, 250);
        });

        ///////////////////////// discord shenanigans ////////////////////////////

        function setpreview(ispreview) {
            let banner = document.querySelector(".preview");       
            if (!banner) {
                banner = document.createElement("div");
                banner.className = "preview";
                banner.style.position = "fixed";
                banner.style.top = "0";
                banner.style.left = "0";
                banner.style.width = "100vw";
                banner.style.height = "100vh";
                banner.style.background = "#141414 url('assets/images/bannersoggle.webp') center center / contain no-repeat";
                banner.style.zIndex = "999999";
                banner.style.display = "none";
                document.body.appendChild(banner);
            }
            banner.style.display = ispreview ? "block" : "none";
        }

        function tinypreview() {
            const tinywidth = 320;
            const tinyheight = 180;
            const istiny = window.innerWidth <= tinywidth && window.innerHeight <= tinyheight;
            setpreview(istiny);
        }
        window.addEventListener("resize", tinypreview);
        window.addEventListener("DOMContentLoaded", tinypreview);
        tinypreview();

    </script>
</body>
</html>