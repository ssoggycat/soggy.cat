<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimal-ui">
    <title>Soggle!</title>
    <link rel="icon" type="image/x-icon" href="icon.png">

    <meta itemprop="name" content="soggle!">
    <meta itemprop="description" content="guess images of shark by their small fragment">

    <meta name="twitter:title" content="ssoggycat">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="summary">
    <meta name="twitter:site" content="@ssoggycat">
    <meta name="twitter:creator" content="@cvsilly_">

    <style>
        @font-face {
            font-family: "karnak condensed"; font-weight: 200 700;
            src: url("../assets/fonts/karnakcondensed.woff") format("woff");
        }
        @font-face {
            font-family: "karnak"; font-weight: 200 700;
            src: url("../assets/fonts/karnak.woff") format("woff");
        }
        @font-face {
            font-family: "clear sans"; font-weight: 200 700;
            src: url("../assets/fonts/clearsans.woff") format("woff");
        }

        /*//////////////////////////////////////////////////////////////////////*/

        body {
            display: flex; margin: 0;
            justify-content: center; align-items: center;
            background-color: #121213; scrollbar-width: thin;
            scrollbar-color: #212121 #121213;
        }
        .top {
            display: flex; position: fixed;
            justify-content: center; align-items: center;
            width: 100vw; height: 60px; top: 0; gap: 3px;
            background-color: #121213; border-bottom: 1px solid #212121;
        }
        .bottom {
            display: flex; position: fixed;
            bottom: 2em; left: 50%;
            transform: translateX(-50%);
            justify-content: center; align-items: stretch;
            width: min(20em, calc(100vw - 2em)); height: 3em;
        }
        .leftbutton, .submit, .hardmodebutton, .input {
            height: 100%; box-sizing: border-box; padding: 0 10px;
            display: flex; align-items: center; justify-content: center;
        }

        .input-group {
            display: flex; height: 100%;
            align-items: stretch;
        }
        .button-group {
            margin-right: 15px;
        }

        .overlay {
            display: flex; position: fixed;
            justify-content: center; align-items: center;
            top: 0; left: 0; z-index: 9999;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.25s;
        }
        .popup {
            display: flex; flex-direction: column;
            justify-content: flex-start;
            width: 400px; max-width: 70vw;
            max-height: 80vh; padding: 30px;
            background-color: #121213;
            overflow-y: auto; box-sizing: border-box;
        }
        .sogface {height: 2em}

        img, canvas, .popup {border-radius: 10px;}

        /*//////////////////////////////////////////////////////////////////////*/

        a, span, br {
            color: white; 
            font-family: "clear sans", sans-serif;
            user-select: none;
        }
        :any-link {color: #6ba1dd;}

        .title {font-family: "karnak condensed", sans-serif; font-size: 2em;}
        .subtitle {font-family: "karnak", sans-serif; font-size: 1.5em;}
        .small {font-size: 0.75em;}
        .tiny {font-size: 0.5em;}
        .dark {color: #999;}

        /*//////////////////////////////////////////////////////////////////////*/

        .close {display: flex; top: 0; justify-content: right;}
        button {
            min-height: 3em; min-width: 3em !important; 
            background: none; appearance: none; border: none;
            padding: 0; outline: none; box-shadow: none;
            cursor: pointer; user-select: none;
            box-sizing: border-box;
        }
        .buttons {
            display: flex; position: absolute;
            align-items: center; justify-content: right;
            right: 1em; height: 100%; top: 0; gap: 5px;
        }
        .buttons img {
            width: 30px; height: 30px;
            object-fit: contain; object-position: left center;
        }

        .leftbutton {
            box-sizing: border-box; padding: 10px;
            display: flex; align-items: center; justify-content: center;
            font-family: "karnak", sans-serif; background: #18181a;
            color: white; border: 1.5px solid #212121;
            font-size: 1em;
        }

        .shuffle {
            height: auto !important;
            font-size: 0.8em !important;
        }

        /* fml */
        .hinthard {
            min-height: 3em;
            font-size: 0.8em !important;
        }
        .hinthard:disabled {
            background: #0f0f0f; color: #555;
            cursor: not-allowed;
        }
        .hardmode {
            color: #dd4444;
            font-size: 0.9em !important;
        }
        .hardmodebutton {
            min-height: 3em; min-width: 4em !important;
            box-sizing: border-box; margin-left: 15px;
        }

        /*//////////////////////////////////////////////////////////////////////*/

        .input {
            font-family: "karnak", sans-serif; font-size: 1em;
            background: #18181a !important; color: white !important;
            padding: 10px; border: 1.5px solid #212121;
            width: 300px; outline: none;
            transition: border-color 0.2s;
            height: 3em; box-sizing: border-box;
            vertical-align: middle;
        }
        .input::placeholder {color: #666; transition: color 0.2s;}
        .input.error {border-color: #dd4444;}
        .input.error::placeholder {color: #dd4444;}

        .submit {
            display: flex; font-family: "karnak", sans-serif; font-size: 1em;
            background: #18181a; color: white;
            justify-content: center; align-items: center;
            padding: 8px; border: 1.5px solid #212121;
            width: 3em; height: 3em; line-height: 1em;
            box-sizing: border-box; outline: none;
        }

        .guesscounter {
            font-family: "karnak", sans-serif; font-size: 0.6em;
            color: #999; text-align: center; height: 15px;
            width: 100%; display: block; margin: 0 auto;
        }
        .guesscounter:not(:empty) {margin-top: 5px}

        /*//////////////////////////////////////////////////////////////////////*/

        .example {
            font-family: "karnak", sans-serif;
            font-size: 0.75em; line-height: 0;
            background: #18181a; color: white;
            border: 1.5px solid #212121;
            padding: 0 !important; margin: 0 !important;
            min-height: 1em !important; max-height: 1em !important;
            vertical-align: middle;
        }
        .dude {
            width: 100vw; height: 100vh;
            z-index: 99999; display: none; opacity: 0;
        }

        .imagebox {
            display: flex; position: absolute;
            justify-content: center; align-items: center;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            max-width: 70%; max-height: 70%; width: 1000px; height: 1000px;
            pointer-events: none; user-select: none; z-index: -1;
        }
        .imagebox canvas {max-width: 100%; max-height: 100%}

        .answer {
            position: fixed; font-family: "karnak", sans-serif; font-size: 1em;
            color: #6ba1dd; background: #18181a;
            padding: 8px 15px; border: 1.5px solid #212121;
            border-radius: 10px; z-index: 1000; opacity: 0;
            transition: opacity 0.3s; pointer-events: none;
        }
        .answer.show {opacity: 1;}

        .button-group {
            display: flex; flex-direction: row; 
            gap: 0
        }

        @media (min-width: 601px) {
            .hint {
                max-width: 4em !important;
            }
            .hinthard {
                max-width: 4em !important;
            }
        }

        /* mobile view */
        @media (max-width: 600px) {
            .leftbutton {
                font-size: 1em !important;
            }
            .bottom {
                flex-direction: column; align-items: center;
                justify-content: flex-start; height: auto; gap: 0;
                bottom: 10px; width: 100vw; left: 0; bottom: 2em;
                transform: none; padding: 0
            }

            .button-group {width: 90vw; max-width: 400px; margin-bottom: 8px}
            .button-group .leftbutton {flex: 1 1 0; margin: 0;}
            .inputbox {width: 90vw; max-width: 400px; margin: 0 auto;}
            .input-group {width: 100%; display: flex;}
            .input {width: 100%; min-width: 0; box-sizing: border-box;}
            .submit {width: 3em; min-width: 3em; max-width: 3em;}

            .hardmodebutton {
                width: 90vw; max-width: 400px; margin: 8px 0 0 0;
                border-radius: 0 0 10px 10px; border-top: none;
                display: flex; justify-content: center;
            }
            .guesscounter {
                width: 100vw; max-width: 400px; text-align: center;
                margin: 16px auto 0 auto; align-self: center;
                position: relative; left: 0;
            }

            .hardmodebutton, .button-group {
                margin-left: 0; margin-right: 0;
            }
        }
        .guesscounter {
            position: fixed; left: 50%;
            bottom: 0.5em; transform: translateX(-50%);
            font-family: "karnak", sans-serif; font-size: 0.6em;
            color: #999; text-align: center;
            height: 15px; width: 100vw; max-width: 400px;
            margin: 0; background: none;
            z-index: 100; clear: none; float: none;
        }

    </style>

</head>
<body>

    <div class="top">
        <a class="title">Soggle</a>
        <img class="sogface" src="../assets/images/sogface.webp" draggable="false">

        <div class="buttons">
            <button class="volume">
                <img src="../assets/svgs/unmuted.svg" height="30" draggable="false">
            </button>
            <button class="info">
                <img src="../assets/svgs/info.svg" height="30" draggable="false">
            </button>
        </div>
    </div>

    <img class="dude" src="../assets/images/dude.webp" draggable="false">
    <audio class="meow" style="display:none" src="../assets/audio/meow.mp3" preload="auto"></audio>
    <audio class="buzzer" style="display:none" src="../assets/audio/buzzer.mp3" preload="auto"></audio>

    <div class="overlay infooverlay" style="display: none;">
        <div class="infopopup popup">

            <div class="close">
                <button class="infocloseb">
                    <img src="../assets/svgs/close.svg" height="30" draggable="false">
                </button>
            </div>

            <a class="title">Soggle</a>
            <a class="subtitle small">wordle but sog. do you get it. do you?</a>
            <br>
            <span>get 380+ titles of images of shark right!</span>
            <br>
            <span>this game is based on the <a href="https://drive3.soggy.cat">soggy drive</a>"s file naming system, which is most commonly used across reposts.</span>
            <span>you should familiarize yourself with it before even considering playing this..</span>
            <span class="tiny dark">(it"s a pretty bad concept for a game, but hey, there had to be a soggy cat wordle at some point)</span>
            <br>
            <a class="subtitle">how to play</a>
            <span>if you remember the image"s name from the drive, input its filename. <a class="dark">(ex. "pillow<s class="darker">.jpg</s>")</a></span>
            <br>
            <span>if not, you can press the <button class="example">hint</button> button to reveal the length!</span>
            <br>
            <span>if you're stuck, you can <button class="example" style="vertical-align: middle;">shuffle</button> for a new soggle.</span>
            <br>
            <a class="subtitle">hard mode</a>
            <span><button class="example" style="vertical-align: middle; color: #dd4444">hard mode</button> crops the image into a small segment!</span>
            <br>
            <span>it starts off at ⅛th, but you can use the <button class="example" style="vertical-align: middle;">hint</button> button to reveal up to half of it.</span>

        </div>
    </div>

    <div class="overlay winoverlay" style="display: none;">
        <div class="winpopup">
            <img src="../assets/images/riches.webp" width="100%" draggable="false">
        </div>
    </div>

    <div class="imagebox">
        <canvas class="sog" width="1000" height="1000"></canvas>
    </div>

    <div class="answer answertext"></div>

    <div class="bottom">
        <div class="button-group">
            <button class="leftbutton shuffle">shuffle</button>
            <button class="leftbutton hint">hint</button>
            <button class="leftbutton hinthard" style="display: none;">hint (+¼)</button>
        </div>
        <div class="inputbox">
            <div class="input-group">
                <input class="input" type="text" placeholder="name it!" list="imagenames">
                <datalist id="imagenames"></datalist>
                <button class="submit">↵</button>
            </div>
        </div>
        <button class="leftbutton hardmode hardmodebutton">hard mode</button>
    </div>

    <div class="guesscounter"></div>

    <script>
        const ctx = document.querySelector(".sog").getContext("2d");
        const hinthardlabels = {16: "⅛", 8: "¼", 4: "¼", 2: "½"};
        const positions = ["top", "bottom", "left", "right"];

        function updatehinthard() {
            const hinthardbutton = document.querySelector(".hinthard");
            const nextfraction = game.fraction / 2;
            if (nextfraction < 2) {
                hinthardbutton.disabled = true;
                hinthardbutton.textContent = "max";
            } else {
                hinthardbutton.textContent = `hint (+${hinthardlabels[nextfraction]})`;
                hinthardbutton.disabled = false;
            }
        }

        function updateguesscounter() {
            const counter = document.querySelector(".guesscounter");
            if (game.guesscount > 0) {
                const label = game.guesscount === 1 ? "guess" : "guesses";
                counter.textContent = `${game.guesscount} ${label}`;
            } else {
                counter.textContent = "";
            }
        }

        function newfragment() {
            if (!game.image) return;
            const canvas = document.querySelector(".sog");
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const img = game.image;
            const scale = Math.min(1000 / img.width, 1000 / img.height);
            const scaledwidth = img.width * scale;
            const scaledheight = img.height * scale;
            const offsetx = (1000 - scaledwidth) / 2;
            const offsety = (1000 - scaledheight) / 2;
            let sx = 0, sy = 0, sw = img.width, sh = img.height;
            let dx = offsetx, dy = offsety, dw = scaledwidth, dh = scaledheight;
            const f = game.fraction;
            if (game.position === "top" || game.position === "bottom") {
                sh = img.height / f;
                dh = scaledheight / f;
                if (game.position === "bottom") {
                    sy = img.height * (f - 1) / f;
                    dy = offsety + scaledheight * (f - 1) / f;
                }
            } else if (game.position === "left" || game.position === "right") {
                sw = img.width / f;
                dw = scaledwidth / f;
                if (game.position === "right") {
                    sx = img.width * (f - 1) / f;
                    dx = offsetx + scaledwidth * (f - 1) / f;
                }
            }
            ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh);
        }

        const baseurl = ["https://raw.githubusercontent.com/ssoggycat/drive-3/refs/heads/main/soggy%20cat/"]
        const images = [
            "3am_sighting.jpg", "a_new_guest.jpg", "AAAHHH.jpg", "alien_2.jpg", "alien_3.jpg", "alien_4.jpg", "alien.jpg", "angry_2.png", "angry_cuddled_2.jpg", "angry_cuddled.jpg", "angry_sob.jpg", "angry.jpg", "angry.png", "angy.jpg", "are_you_fr.jpg", "autumn_2.jpg", "autumn.jpg", "aww_look_at_him.jpg", 
            "baby.jpg", "baffled.jpg", "baggage.jpg", "ball.png", "balls.png", "bathtub_stand.jpg", "beauty_2.jpg", "beauty.jpg", "big_ass_nose.jpg", "big_nose.jpg", "bit_happy_2.jpg", "bit_happy.jpg", "bite_2.jpg", "bite.jpg", "blanket_2.jpg", "blanket.png", "blankets.jpg", "bleh.jpg", "blink.jpg", "blurry.png", "bruh.jpg", "bugs_when_you_lift_up_the_rock.jpg", "burger_2.jpg", "burger.jpg", 
            "camera.jpg", "casual.jpg", "casually_sitting.jpg", "chad.jpg", "cheese_2.png", "cheese.jpg", "chiffy.jpg", "childrens_zone.jpg", "chill.jpg", "close_peek.jpg", "close_up.png", "close-up.jpg", "comfy_blanket.jpg", "confused.jpg", "contained.png", "cool_collar.jpg", "couch.jpg", "creature.jpg", "creepy.jpg", "creepypasta.jpg", "critical_hit.jpg", "crying.jpg", "cuddled_2.jpg", "cuddled.jpg", 
            "damn_thats_crazy.jpg", "darkness.jpg", "deep_sea_creature_2.jpg", "deep_sea_creature.jpg", "dem_paws_2.jpg", "dem_paws.jpg", "demon.jpg", "derp.jpg", "did_you_really_just_do_that.jpg", "disappointed.png", "disapproval.jpg", "DISGUSTED.jpg", "drowning_in_plushies.jpg", "drunk.png", "dry_standing.jpg", "dumb_2.jpg", "dumb_sit.png", "dumb.png", "dundundun.jpg", 
            "ear_grab.jpg", "earless.png", "eepy.jpg", "egg_broke.jpg", "egg.jpg", "elevated.jpg", "empty_stare.png", "enraged.jpg", "epic_selfie_2.jpg", "epic_selfie.jpg", "erm.jpg", "erm.png", "err.jpg", "even_uglier.jpg", "EVIL_CREATURE.png", "evil_goblin.jpg", "EVIL.jpg", "ew.jpg", "eyebrow_raise.jpg", 
            "fack_u.jpg", "far_away.jpg", "fart_2.jpg", "fart.jpg", "fatass_2.jpg", "fatass.jpg", "fear.jpg", "fear.png", "felinus.jpg", "final_footage.png", "finger.jpg", "flat.png", "fluffy_guy.jpg", "fluffy.jpg", "four_doritos_long_2.jpg", "four_doritos_long.jpg", "four_step_stool.jpg", "fresh.jpg", "froggy.jpg", "from_the_shadows.png", "fuck_yuo.jpg", "fucked_up.png", 
            "gamer.jpg", "gang.png", "garage_2.jpg", "garage.jpg", "gay.jpg", "giant.jpg", "giraffe.jpg", "gn.jpg", "golly_jeepers.jpg", "goog_2.png", "goog.png", "grab_the_cat.jpg", "green_eye.jpg", "green_eyed_2.png", "green_eyed.png", "grin.jpg", "groceries.jpg", "grr.jpg", "guh.png", "guuuuh.jpg", "gwah_2.jpg", "gwah_3.jpg", "gwah.jpg", 
            "half_view.jpg", "hamburger.png", "hand_lick.jpg", "happy_face.jpg", "he_has_one_braincell.jpg", "hello_there.jpg", "hello.jpg", "hey.jpg", "hgfdhgfhg.jpg", "hidden.png", "hide.jpg", "hiding.jpg", "hii.jpg", "holding_the_bathtub.jpg", "horrific_2.jpg", "horrific_3.jpg", "horrific.jpg", "horror_2.jpg", "horror.png", "huh.jpg", "hunter.jpg", 
            "i_got_cash_on_me.jpg", "i_will_find_you.jpg", "idiot.jpg", "idk.jpg", "in_bed_2.jpg", "in_bed.jpg", "it_says_gullible_on_the_ceiling.jpg",
            "jawline.jpg", "just_chillin_brah.jpg", "just_minutes_before_the_sog.jpg", 
            "kiss.jpg", 
            "lay_2.jpg", "lay_me_down.png", "lay.jpg", "laying.jpg", "let_me_out.jpg", "lets_see_if_this_is_true_or_rubbish.jpg", "lick.jpg", "literally_DEAD.png", "loaf_shaped.jpg", "long.jpg", "long.png", "look_away.jpg", "look_back.jpg", "look.jpg", "look.png", "looking_outside.jpg", "looking_up.jpg", "lovely_blanket.jpg", 
            "m.jpg", "mad_2.jpg", "mad.jpg", "meow.jpg", "mewing.jpeg", "mewing.jpg", "miau_2.jpg", "miau.jpg", "mid_fart.jpg", "mimimi.jpg", "moments_before_disaster.jpg", "mrow.jpg", "murder_2.jpg", "murder.jpg", 
            "nap.jpg", "near_death_footage.png", "new_york_apartment.jpg", "no_ears.jpg", "nom.jpg", "non-deep_sea_creature.jpg", "nose_to_the_right.jpg", "nose_to_the_top.jpg", "not_aaah.png", "not_so_evil_anymore.png", 
            "okay_sure.jpg", "one_ruffle_cheddar_long.jpg", "outside.jpg", 
            "package.jpg", "panic.jpg", "pants.jpg", "pat_from_the_back.jpg", "paw_2.jpg", "paw_licking.jpg", "paw.jpg", "paws.jpg", "peering_closer_to_the_enemy.jpg", "penis.jpg", "pent_up.jpg", "pet_on_the_back.jpg", "pet_pet_pet.jpg", "pet.jpg", "pillow.jpg", "pinned_down.jpg", "piss.jpg", "plastic_cup.png", "playground_2.jpg", "playground.jpg", "plead.jpg", "pluh.png", "plushie_2.jpg", "plushie.jpg", "pog.png", "polite.jpg", "popsicle.jpg", "prayers.jpg", "preparation.jpg", "prepared.jpg", "proud_stand.jpg", "psychopath.jpg", "purr.png", "pushing_away.jpg", 
            "quicksand_2.jpg", "quicksand_3.jpg", "quicksand.jpg", 
            "raaah.jpg", "RAAH.jpg", "rapidly_approaching.jpg", "rich.jpg", "rich.png", "rubber_ducky.jpg", "sad_face.png", 
            "sad.png", "scared.jpg", "SCREAM_FOR_HELP.jpg", "scream.jpg", "selfie.png", "shock.jpg", "shocking.jpg", "shoes.png", "shut_up.jpg", "side_of_the_road.jpg", "side_sleep.jpg", "sigma.jpg", "sit.png", "skinwalker_pretending_to_be_a_cat.jpg", "sleeping.jpg", "sleepy.jpg", "slide_to_the_left.jpg", "smirk.jpg", "smoke_weed_every_day.jpg", "snake.jpg", "sneak.jpg", "sniff_2.jpg", "sniff_3.jpg", "sniff.png", "SNOOORT.jpg", "snooping_around.jpg", "snore.jpg", "snowed_up_2.png", "snowed_up.jpg", "so_damn_long.jpg", "sob.jpg", "sobbing.jpg", "soft_covers.jpg", "sog_look.png", "sog_stare.jpg", "soggy.jpg", "spooky.jpg", "stand.jpg", "standing_out_there.jpg", "standing.jpg", "stare.jpg", "stares_at_you.jpg", "staring.jpg", "staring.png", "stealth.jpg", "sticking_out_tongue.jpg", "striking_a_pose.jpg", "stupid.jpg", "sun_rays.jpg", "supa_angry.jpg", "suspension.jpg", 
            "teehee.jpg", "terrifying.jpg", "THE_BEAST_HAS_AWOKEN.jpg", "the_creature.jpg", "the_thing.jpg", "thing.jpg", "thug_gangster_ass_shit_2.jpg", "thug_gangster_ass_shit.jpg", "tilt.jpg", "tired.jpg", "tongue.jpg", "trampoline_fear_2.jpg", "trampoline_fear.jpg", "trampoline_trapped.jpg", "trampoline.png", "trauma.jpg", "traumatized.jpg", "true_fear.jpg", "trying_to_sleep.jpg", 
            "ugly.jpg", "UGLY.png", "uh_um.jpg", "um_hello.png", "underground_monster.jpg", "unsightly_beast.jpg", "unsure.jpg", 
            "very_chill.jpg", "very_ugly.jpg", 
            "waddle.jpg", "walking_away.jpg", "weird_sit.jpg", "weirdo.jpg", "went_outside.jpg", "wha.jpg", "whagt.jpg", "what_are_you_talking_about.png", "what_do_you_want.jpg", "what_if_i_just_bite_you_for_no_reason.jpg", "WHAT.jpg", "what.png", "whats_that.jpg", "who_are_you.jpg", "whoa.jpg", "whuh...png", "WHUHH.jpg", "why_does_he_look_like_that.jpg", "why_the_big_nose.png", "why_the_wide_face.jpg", "wide_lay.jpg", "wink_3.jpg", "wink.jpg", "wise_thinker.jpg", "wise.png", "woah.jpg", "woah.png", "womp_womp.png", "wonderful_bench.jpg", "wtf_did_you_just_say.jpg", "wtf.jpg", 
            "yay.jpg", "yeah_okay.jpg", "yellow_eyed.jpg", "you_all_sicken_me.jpg", "YOU.jpg", "youre_gonna_talk_to_me_like_that_huh.jpg", "yucky.jpg", "yummers.jpg", "yummy.jpg", 
            "zzz.jpg", "zzzzzz.jpg",
        ];

        // game state
        let game = {
            image: null,
            imagename: "",
            imagenamefile: "",
            fraction: 1,
            position: "",
            haswon: false,
            guesscount: 0
        };

        // kind of? prevent animation spam
        let isanimating = false;
        let isansweranimating = false;

        let incorrectanswers = new Set();

        function random(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function adddata() {
            const datalist = document.getElementById("imagenames");
            datalist.innerHTML = "";
            images.forEach(imagename => {
                const option = document.createElement("option");
                const cleanname = imagename.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "").replace(/_/g, " ");
                option.value = cleanname;
                datalist.appendChild(option);
            });
        }

        async function loadimage(imagename) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                const imagenamefix = imagename.replace(/_/g, "%20");
                let urlindex = 0;

                const loadurl = () => {
                    if (urlindex >= baseurl.length) {
                        reject(new Error("all urls failed"));
                        return;
                    }
                    img.src = baseurl[urlindex] + imagenamefix; 
                    urlindex++;
                    
                    const timeout = setTimeout(() => {
                        img.onload = img.onerror = null;
                        loadurl();
                    }, 3000);
                    img.onload = () => {clearTimeout(timeout); resolve(img)};
                    img.onerror = () => {clearTimeout(timeout); loadurl()};
                }; 
                loadurl();
            });
        }

        //////////////////////////////////////////////////////////////////////////

        function savegamestate() {
            const gamestate = {
                imagenamefile: game.imagenamefile,
                hardmode: document.querySelector(".hardmodebutton").textContent === "normal mode",
                fraction: game.fraction,
                position: game.position,
                incorrectanswers: Array.from(incorrectanswers),
                guesscount: game.guesscount
            };
            localStorage.setItem("gamestate", JSON.stringify(gamestate));
        }
        async function loadgamestate() {
            const saved = localStorage.getItem("gamestate");
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    if (state.imagenamefile && images.includes(state.imagenamefile)) {
                        const img = await loadimage(state.imagenamefile);
                        game.image = img;
                        game.imagenamefile = state.imagenamefile;
                        game.imagename = state.imagenamefile.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "").replace(/_/g, " ");
                        game.fraction = state.fraction || 1;
                        game.position = state.position || random(positions);
                        game.haswon = false;
                        game.guesscount = state.guesscount || 0;
                        incorrectanswers = new Set(state.incorrectanswers || []);
                        const hardbutton = document.querySelector(".hardmodebutton");
                        if (state.hardmode) {
                            hardbutton.textContent = "normal mode";
                            hardbutton.style.color = "white";
                            document.querySelector(".hinthard").style.display = "flex";
                            document.querySelector(".hint").style.display = "none";
                        } else {
                            hardbutton.textContent = "hard mode";
                            hardbutton.style.color = "#dd4444";
                            document.querySelector(".hint").style.display = "flex";
                            document.querySelector(".hinthard").style.display = "none";
                        }
                        updatehinthard();
                        updateguesscounter();
                        newfragment();
                        return true;
                    }
                } catch (e) {}
            }
            return false;
        }

        //////////////////////////////////////////////////////////////////////////

        async function newgame(fraction = null, keepmode = false) {
            let hardmode = document.querySelector(".hardmodebutton").textContent === "normal mode";
            if (fraction === null) {
                fraction = hardmode ? 16 : 1;
            }
            game.haswon = false;
            game.guesscount = 0;
            incorrectanswers.clear();
            for (let attempts = 0; attempts < images.length; attempts++) {
                const imagename = random(images);
                try {
                    const img = await loadimage(imagename);
                    game.image = img;
                    game.imagenamefile = imagename;
                    game.imagename = imagename.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "").replace(/_/g, " ");
                    game.fraction = fraction;
                    game.position = random(positions);
                    const input = document.querySelector(".input");
                    input.value = "";
                    input.placeholder = "name it!";
                    input.classList.remove("error");
                    updatehinthard();
                    updateguesscounter();
                    newfragment();
                    savegamestate();
                    return;
                } catch (err) {
                    console.error(`failed to load this goober - ${imagename}:`, err);
                }
            }
            document.querySelector(".input").placeholder = "no images available?!";
        }

        function showanswer(crossed = false) {
            if (isansweranimating) return;
            isansweranimating = true;
            
            const answertext = document.querySelector(".answertext");
            const input = document.querySelector(".input");
            const inputrect = input.getBoundingClientRect();

            let displayname;
            if (crossed) {
                displayname = game.imagename.replace(/[^\s]/g, "-");
                const length = game.imagename.replace(/\s/g, "").length;
                answertext.textContent = `${displayname} (${length} symbols)`;
            } else {
                answertext.textContent = `the image was: ${game.imagename}`;
            }

            answertext.style.left = `${inputrect.left + inputrect.width / 2}px`;
            answertext.style.top = `${inputrect.top - 50}px`;
            answertext.style.transform = "translateX(-50%)";
            answertext.classList.add("show");

            setTimeout(() => {
                answertext.classList.remove("show");
                isansweranimating = false;
            }, 2000);
        }

        document.querySelector(".hint").addEventListener("click", () => {
            showanswer(true);
        });

        /*                                                       /
        
        
                  WIN FUNCTION BELOW!!!!!!!! YOU IDIOT
               (just to cv, not anyone else reading this)
        
        
        /                                                       */
        function checkanswer() {
            const input = document.querySelector(".input");
            const answer = input.value.trim().toLowerCase();
            const correct = game.imagename.toLowerCase();
            
            if (answer === correct) {
                game.fraction = 1; 
                input.value = "";
                game.haswon = true;
                newfragment(); updatehinthard();
                document.querySelector(".meow").play()
                savegamestate();
                const winoverlay = document.querySelector(".winoverlay");
                winoverlay.style.opacity = "1";
                winoverlay.style.pointerEvents = "auto";
                setTimeout(() => {
                    winoverlay.style.transition = "opacity 4s";
                    winoverlay.style.opacity = "0";
                    winoverlay.style.pointerEvents = "none";
                    setTimeout(() => {
                        winoverlay.style.transition = "";
                        winoverlay.style.display = "none";
                    }, 4000);
                }, 100);
                winoverlay.style.display = "flex";

            } else {
                if (isanimating) return;
                isanimating = true;
                
                if (answer) {
                    incorrectanswers.add(answer);
                    game.guesscount++;
                    savegamestate();
                    updateguesscounter();
                    adddata();
                }
                input.classList.add("error");
                input.placeholder = "[𝐋𝐎𝐔𝐃 𝐈𝐍𝐂𝐎𝐑𝐑𝐄𝐂𝐓 𝐁𝐔𝐙𝐙𝐄𝐑]";
                input.value = "";
                document.querySelector(".buzzer").pause(); 
                document.querySelector(".buzzer").currentTime = 0; 
                document.querySelector(".buzzer").play();
                setTimeout(() => {
                    input.classList.remove("error");
                    input.placeholder = "name it!";
                    isanimating = false;
                }, 500);
            }
        }

        //////////////////////////////////////////////////////////////////////////

        document.querySelector(".sogface").addEventListener("click", () => {
            document.querySelector(".meow").play();
        });

        document.querySelector(".shuffle").addEventListener("click", async () => {
            if (!game.haswon) {
                showanswer();
                setTimeout(async () => {
                    await newgame();
                }, 1000);
            } else {
                await newgame();
            }
        });

        document.querySelector(".hinthard").addEventListener("click", () => {
            if (game.image && game.fraction > 2) {
                game.fraction = game.fraction / 2;
                newfragment(); 
                updatehinthard();
                savegamestate();
            }
        });

        document.querySelector(".submit").addEventListener("click", checkanswer);
        document.querySelector(".input").addEventListener("keypress", (e) => {
            if (e.key === "Enter" || e.keyCode === 13) checkanswer();
        });

        const hardmodebutton = document.querySelector(".hardmodebutton");
        let hardmode = false;
        hardmodebutton.addEventListener("click", async () => {
            hardmode = !hardmode;
            if (hardmode) {
                hardmodebutton.textContent = "normal mode";
                hardmodebutton.style.color = "white";
                document.querySelector(".hinthard").style.display = "flex";
                document.querySelector(".hint").style.display = "none";
                await newgame(16);
            } else {
                hardmodebutton.textContent = "hard mode";
                hardmodebutton.style.color = "#dd4444";
                document.querySelector(".hint").style.display = "flex";
                document.querySelector(".hinthard").style.display = "none";
                await newgame(1);
            }
            savegamestate();
        });
        
        // prevent file extensions in input, just in case the player forgot
        document.querySelector(".input").addEventListener("input", function() {
            this.value = this.value.replace(/\.(jpg|jpeg|png|webp|mp4|jfif)$/i, "");
        });

        //////////////////////////////// info tab ////////////////////////////////

        document.querySelectorAll(".example").forEach(el => {
            el.addEventListener("click", () => {
            const disappointment = document.querySelector(".dude");
            disappointment.style.display = "block";
            setTimeout(() => {
                disappointment.style.transition = "opacity 10s";
                disappointment.style.opacity = "1";
            }, 700);
            setTimeout(() => {
                disappointment.style.display = "none";
                disappointment.style.opacity = "0";
                disappointment.style.transition = "";
                el.remove();
            }, 8000);
            });
        });

        document.addEventListener("DOMContentLoaded", async () => {
            adddata();
            const visited = window.visited;
            if (!localStorage.getItem("visited")) {
                localStorage.setItem("visited", "true");
                const infooverlay = document.querySelector(".infooverlay");
                const infopopup = document.querySelector(".infopopup");
                infooverlay.style.display = "flex";
                infopopup.style.transition = "transform 0.25s";
                infopopup.style.transform = "translateY(-30px)";
                infooverlay.style.opacity = "1";
                infooverlay.style.pointerEvents = "auto";
                requestAnimationFrame(() => {infopopup.style.transform = ""});
            }
            let sitemuted = false;
            const volumebutton = document.querySelector('.volume');
            const volumeicon = volumebutton.querySelector('img');
            volumebutton.addEventListener('click', () => {
                sitemuted = !sitemuted;
                document.querySelectorAll('audio').forEach(audio => {
                    audio.muted = sitemuted;
                });
                volumeicon.src = sitemuted
                    ? '../assets/svgs/muted.svg'
                    : '../assets/svgs/unmuted.svg';
            });
            if (!(await loadgamestate())) {
                await newgame();
            }
        });

        document.querySelector(".info").addEventListener("click", () => {
            const infooverlay = document.querySelector(".infooverlay");
            const infopopup = document.querySelector(".infopopup");
            infooverlay.style.display = "flex";
            infopopup.style.transition = "transform 0.25s";
            infopopup.style.transform = "translateY(-30px)";
            infooverlay.style.opacity = "1";
            infooverlay.style.pointerEvents = "auto";
            requestAnimationFrame(() => {infopopup.style.transform = ""});
        });

        document.querySelector(".infocloseb").addEventListener("click", () => {
            const infooverlay = document.querySelector(".infooverlay");
            const infopopup = document.querySelector(".infopopup");
            infopopup.style.transition = "transform 0.25s";
            infopopup.style.transform = "translateY(30px)";
            infooverlay.style.opacity = "0";
            infooverlay.style.pointerEvents = "none";
            setTimeout(() => {
                infooverlay.style.display = "none";
                infopopup.style.transition = "";
                infopopup.style.transform = "";
            }, 250);
        });

        //////////////////////////////////////////////////////////////////////////

    </script>
</body>
</html>